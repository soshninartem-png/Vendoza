{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–°–æ–∑–¥–∞—Ç—å —Ç–æ–≤–∞—Ä</title>
<link rel="stylesheet" href="{% static 'css/styles.css' %}">
<style>
body {
    font-family: 'Poppins', Arial, sans-serif;
    background: linear-gradient(135deg, #f0f2f5, #e8ebee);
    padding: 30px;
    color: #333;
}
.form-container {
    max-width: 850px;
    margin: 0 auto;
    background: #fff;
    padding: 50px;
    border-radius: 20px;
    box-shadow: 0 15px 50px rgba(0,0,0,0.08);
    transition: 0.3s;
}
.form-container:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 60px rgba(0,0,0,0.12);
}
h1 {
    text-align: center;
    color: #007bff;
    margin-bottom: 40px;
    font-weight: 700;
    letter-spacing: 1px;
}
.form-group {
    margin-bottom: 22px;
    position: relative;
}
label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #555;
}
input[type="text"],
input[type="number"],
input[type="email"],
input[type="tel"],
select,
textarea {
    width: 100%;
    padding: 14px 16px;
    border-radius: 12px;
    border: 1px solid #ddd;
    font-size: 15px;
    transition: all 0.3s;
    background: #fafafa;
    box-sizing: border-box;
}
input:focus, select:focus, textarea:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 10px rgba(0,123,255,0.2);
}
textarea { resize: vertical; }

.photo-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
    margin-top: 10px;
}
.photo-card {
    width: 100%;
    padding-top: 100%;
    position: relative;
    border-radius: 10px;
    border: 2px dashed #ccc;
    background: #fafafa;
    cursor: pointer;
    overflow: hidden;
    transition: all 0.3s;
}
.photo-card:hover {
    border-color: #007bff;
    background: #e7f1ff;
}
.photo-card img {
    position: absolute;
    top:0; left:0; right:0; bottom:0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s;
}
.photo-card:hover img {
    transform: scale(1.05);
}
.add-icon {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 30px;
    color: #007bff;
    font-weight: bold;
}
.delete-btn {
    position: absolute;
    top: 4px;
    right: 4px;
    width: 22px;
    height: 22px;
    background: rgba(255,255,255,0.9);
    border: none;
    border-radius: 50%;
    color: #ff4d4f;
    font-weight: bold;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    transition: background 0.2s;
}
.delete-btn:hover {
    background: #fff;
}
.submit-btn {
    width: 100%;
    padding: 16px;
    background: linear-gradient(90deg, #007bff, #0056b3);
    color: white;
    border: none;
    border-radius: 14px;
    font-size: 17px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 6px 15px rgba(0,0,0,0.1);
}
.submit-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.15);
}
.alert {
    padding: 12px 16px;
    border-radius: 10px;
    margin-bottom: 20px;
    font-weight: 500;
}
.alert-success { background: #d4edda; color: #155724; }
.alert-error   { background: #f8d7da; color: #721c24; }

@media (max-width: 700px) {
    .photo-grid { grid-template-columns: repeat(2, 1fr); }
    .form-container { padding: 24px; }
}
</style>
</head>
<body>
<div class="form-container">
    <h1>üì¶ –°–æ–∑–¥–∞—Ç—å —Ç–æ–≤–∞—Ä</h1>

    {% if messages %}
        {% for message in messages %}
            <div class="alert {% if message.tags == 'error' %}alert-error{% else %}alert-success{% endif %}">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}

        <!-- –ù–∞–∑–≤–∞–Ω–∏–µ -->
        <div class="form-group">
            <label for="name">–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
            <input type="text" id="name" name="name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, iPhone 11 —Å –≥–∞—Ä–∞–Ω—Ç–∏–µ–π" maxlength="200" required>
        </div>

        <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
        <div class="form-group">
            <label for="category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
            <select id="category" name="category">
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                {% for cat in categories %}
                    <option value="{{ cat.id }}">{{ cat.name }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- –¶–µ–Ω–∞ -->
        <div class="form-group">
            <label for="price">–¶–µ–Ω–∞ *</label>
            <input type="number" id="price" name="price" placeholder="0.00" step="0.01" min="0" required>
        </div>

        <!-- –ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è -->
        <div class="form-group">
            <label for="unit_type">–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è</label>
            <select id="unit_type" name="unit_type">
                <option value="pcs">–®—Ç—É–∫–∏ (pcs)</option>
                <option value="kg">–ö–∏–ª–æ–≥—Ä–∞–º–º—ã (kg)</option>
            </select>
        </div>

        <!-- –§–æ—Ç–æ (8 —à—Ç—É–∫) -->
        <div class="form-group">
            <label>–§–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞ (–¥–æ 8 —à—Ç—É–∫)</label>
            <div class="photo-grid" id="photoGrid">
                {% for i in "01234567" %}
                    <input type="file" id="photoInput{{ forloop.counter0 }}" name="image" style="display:none;" accept="image/*" onchange="handlePhoto(this, {{ forloop.counter0 }})">
                    <div class="photo-card" id="photoCard{{ forloop.counter0 }}" onclick="document.getElementById('photoInput{{ forloop.counter0 }}').click()">
                        <span class="add-icon">+</span>
                    </div>
                {% endfor %}
            </div>
            <small style="color:#888; margin-top:8px; display:block;">–ü–µ—Ä–≤–æ–µ —Ñ–æ—Ç–æ –±—É–¥–µ—Ç –≥–ª–∞–≤–Ω—ã–º</small>
        </div>

        <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
        <div class="form-group">
            <label for="description">–û–ø–∏—Å–∞–Ω–∏–µ</label>
            <textarea id="description" name="description" placeholder="–û–ø–∏—à–∏—Ç–µ —Ç–æ–≤–∞—Ä –ø–æ–¥—Ä–æ–±–Ω–µ–µ" maxlength="2000" rows="6"></textarea>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ -->
        <div class="form-group">
            <button type="submit" class="submit-btn">üöÄ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä</button>
        </div>
    </form>
</div>

<script>
const photoFiles = Array(8).fill(null);

function handlePhoto(input, index) {
    const file = input.files[0];
    if (!file) return;

    photoFiles[index] = file;

    const card = document.getElementById('photoCard' + index);
    const reader = new FileReader();

    reader.onload = function(e) {
        card.innerHTML = '';

        const img = document.createElement('img');
        img.src = e.target.result;
        card.appendChild(img);

        const delBtn = document.createElement('button');
        delBtn.classList.add('delete-btn');
        delBtn.type = 'button';
        delBtn.innerHTML = '&times;';
        delBtn.onclick = function(ev) {
            ev.stopPropagation();
            photoFiles[index] = null;
            input.value = '';
            card.innerHTML = '<span class="add-icon">+</span>';
            card.onclick = function() {
                document.getElementById('photoInput' + index).click();
            };
        };
        card.appendChild(delBtn);

        // –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ ‚Äî —É–±–∏—Ä–∞–µ–º onclick —Å –∫–∞—Ä—Ç–æ—á–∫–∏ —á—Ç–æ–±—ã –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å —Ñ–∞–π–ª –ø–æ–≤—Ç–æ—Ä–Ω–æ
        card.onclick = null;
    };

    reader.readAsDataURL(file);
}
</script>
</body>
</html>