{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ category_name }} â€” FreshMart</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Clash+Display:wght@500;600;700&family=Satoshi:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root {
      --green:       #1a6b3a;
      --green-mid:   #228b4a;
      --green-light: #2ecc71;
      --green-pale:  #edfaf3;
      --accent:      #f97316;
      --accent-dark: #ea6c0a;
      --text:        #0f1c14;
      --text-mid:    #4a5568;
      --text-soft:   #8a9ba8;
      --surface:     #ffffff;
      --bg:          #f5f9f6;
      --border:      #e2ece6;
      --shadow-sm:   0 2px 8px rgba(0,0,0,.06);
      --shadow-md:   0 8px 28px rgba(0,0,0,.09);
      --shadow-lg:   0 20px 56px rgba(26,107,58,.16);
      --r-sm:        10px;
      --r-md:        16px;
      --r-lg:        24px;
      --r-xl:        32px;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Satoshi', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       NAVBAR
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .navbar {
      position: sticky; top: 0; z-index: 200;
      background: rgba(255,255,255,.92);
      backdrop-filter: blur(16px);
      border-bottom: 1px solid var(--border);
      padding: 0 32px;
      height: 66px;
      display: flex; align-items: center; justify-content: space-between;
    }
    .nav-logo {
      font-family: 'Clash Display', sans-serif;
      font-size: 22px; font-weight: 700;
      color: var(--green); text-decoration: none;
      display: flex; align-items: center; gap: 8px;
    }
    .nav-logo .dot { color: var(--accent); }
    .nav-right { display: flex; align-items: center; gap: 10px; }
    .nav-btn {
      display: flex; align-items: center; gap: 7px;
      padding: 9px 18px; border-radius: 50px;
      font-size: 14px; font-weight: 600;
      text-decoration: none; transition: all .2s;
      font-family: 'Satoshi', sans-serif;
      cursor: pointer; border: none;
    }
    .nav-btn-ghost {
      background: transparent; color: var(--text-mid);
      border: 1.5px solid var(--border);
    }
    .nav-btn-ghost:hover { border-color: var(--green); color: var(--green); background: var(--green-pale); }
    .nav-btn-primary {
      background: var(--green); color: #fff;
      box-shadow: 0 4px 14px rgba(26,107,58,.3);
    }
    .nav-btn-primary:hover { background: var(--green-mid); transform: translateY(-1px); box-shadow: 0 6px 18px rgba(26,107,58,.38); }
    .cart-badge {
      background: var(--accent); color: #fff;
      font-size: 10px; font-weight: 800;
      width: 18px; height: 18px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      margin-left: -4px;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HERO
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .hero {
      position: relative; overflow: hidden;
      background: linear-gradient(135deg, #0d3d20 0%, #1a6b3a 45%, #228b4a 100%);
      padding: 56px 32px 52px;
    }
    .hero::before {
      content: '';
      position: absolute; inset: 0;
      background:
        radial-gradient(ellipse 60% 80% at 90% 50%, rgba(46,204,113,.18) 0%, transparent 70%),
        radial-gradient(ellipse 40% 60% at 10% 80%, rgba(249,115,22,.12) 0%, transparent 60%);
    }
    .hero::after {
      content: '';
      position: absolute; bottom: -1px; left: 0; right: 0;
      height: 40px;
      background: var(--bg);
      clip-path: ellipse(55% 100% at 50% 100%);
    }
    .hero-inner {
      max-width: 1240px; margin: 0 auto;
      position: relative; z-index: 1;
    }
    .breadcrumb {
      display: flex; align-items: center; gap: 8px;
      font-size: 13px; color: rgba(255,255,255,.5);
      margin-bottom: 20px;
    }
    .breadcrumb a { color: rgba(255,255,255,.75); text-decoration: none; transition: color .2s; }
    .breadcrumb a:hover { color: #fff; }
    .breadcrumb-sep { font-size: 11px; }

    .hero-content { display: flex; align-items: center; gap: 24px; }
    .hero-icon {
      width: 80px; height: 80px; border-radius: 24px; flex-shrink: 0;
      background: rgba(255,255,255,.12);
      border: 1.5px solid rgba(255,255,255,.2);
      backdrop-filter: blur(8px);
      display: flex; align-items: center; justify-content: center;
      font-size: 40px;
      box-shadow: 0 8px 32px rgba(0,0,0,.2);
    }
    .hero-text h1 {
      font-family: 'Clash Display', sans-serif;
      font-size: clamp(28px, 4vw, 46px);
      font-weight: 700; color: #fff; line-height: 1.1;
      letter-spacing: -0.5px;
    }
    .hero-text p {
      color: rgba(255,255,255,.6); font-size: 15px; margin-top: 8px;
    }
    .hero-stats {
      display: flex; gap: 24px; margin-top: 20px;
    }
    .hero-stat {
      background: rgba(255,255,255,.1);
      border: 1px solid rgba(255,255,255,.15);
      border-radius: var(--r-sm);
      padding: 10px 18px; text-align: center;
    }
    .hero-stat strong { display: block; font-size: 20px; font-weight: 700; color: #fff; }
    .hero-stat span { font-size: 12px; color: rgba(255,255,255,.55); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CONTROLS BAR
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .controls-wrap {
      max-width: 1240px; margin: 0 auto;
      padding: 28px 32px 0;
    }
    .controls {
      background: var(--surface);
      border-radius: var(--r-lg);
      border: 1px solid var(--border);
      box-shadow: var(--shadow-sm);
      padding: 16px 20px;
      display: flex; align-items: center;
      justify-content: space-between;
      flex-wrap: wrap; gap: 12px;
    }
    .controls-left { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }

    .search-form { display: flex; align-items: center; gap: 0; }
    .search-wrap {
      position: relative; display: flex; align-items: center;
    }
    .search-icon {
      position: absolute; left: 14px;
      color: var(--text-soft); font-size: 14px; pointer-events: none;
    }
    .search-input {
      border: 2px solid var(--border);
      border-right: none;
      border-radius: var(--r-sm) 0 0 var(--r-sm);
      padding: 10px 16px 10px 40px;
      font-size: 14px; font-family: 'Satoshi', sans-serif;
      outline: none; width: 260px; background: var(--bg);
      color: var(--text); transition: border-color .2s, background .2s;
    }
    .search-input:focus { border-color: var(--green); background: #fff; }
    .search-input::placeholder { color: var(--text-soft); }
    .search-submit {
      background: var(--green); color: #fff;
      border: 2px solid var(--green);
      border-radius: 0 var(--r-sm) var(--r-sm) 0;
      padding: 10px 20px; font-size: 14px; font-weight: 600;
      font-family: 'Satoshi', sans-serif;
      cursor: pointer; transition: background .2s;
      display: flex; align-items: center; gap: 6px;
    }
    .search-submit:hover { background: var(--green-mid); border-color: var(--green-mid); }

    .count-badge {
      background: var(--green-pale); color: var(--green);
      border: 1.5px solid rgba(26,107,58,.2);
      padding: 9px 16px; border-radius: 50px;
      font-size: 13px; font-weight: 600;
    }

    .sort-select {
      border: 2px solid var(--border); border-radius: var(--r-sm);
      padding: 10px 14px; font-size: 14px;
      font-family: 'Satoshi', sans-serif; font-weight: 500;
      background: var(--bg); color: var(--text);
      cursor: pointer; outline: none; transition: border-color .2s;
    }
    .sort-select:focus { border-color: var(--green); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       GRID
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .grid-wrap {
      max-width: 1240px; margin: 28px auto 60px;
      padding: 0 32px;
    }
    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 22px;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PRODUCT CARD
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .prod-card {
      background: var(--surface);
      border-radius: var(--r-lg);
      border: 1.5px solid var(--border);
      overflow: hidden;
      display: flex; flex-direction: column;
      transition: transform .3s cubic-bezier(.34,1.56,.64,1), box-shadow .3s ease, border-color .3s;
      animation: fadeUp .5s ease both;
    }
    .prod-card:hover {
      transform: translateY(-8px);
      box-shadow: var(--shadow-lg);
      border-color: rgba(26,107,58,.25);
    }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(20px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    {% for i in "123456789012" %}
    .prod-card:nth-child({{ forloop.counter }}) { animation-delay: {{ forloop.counter0 }}0ms; }
    {% endfor %}

    /* Image area */
    .prod-img {
      position: relative; background: #f0f4f1;
      aspect-ratio: 1/1; overflow: hidden;
    }
    .prod-img img {
      width: 100%; height: 100%; object-fit: cover;
      transition: transform .5s cubic-bezier(.25,.46,.45,.94);
    }
    .prod-card:hover .prod-img img { transform: scale(1.08); }

    .prod-badge {
      position: absolute; top: 12px; left: 12px; z-index: 3;
      background: var(--accent); color: #fff;
      font-size: 10px; font-weight: 800; letter-spacing: .8px;
      padding: 4px 10px; border-radius: 50px;
      text-transform: uppercase;
      box-shadow: 0 2px 8px rgba(249,115,22,.4);
    }
    .prod-badge.sale { background: #e53e3e; }

    /* Wishlist */
    .wish-form { margin: 0; }
    .wish-btn {
      position: absolute; top: 10px; right: 10px; z-index: 3;
      width: 36px; height: 36px; border-radius: 50%;
      background: rgba(255,255,255,.9);
      border: none; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 2px 10px rgba(0,0,0,.15);
      transition: transform .2s, background .2s;
      backdrop-filter: blur(4px);
    }
    .wish-btn:hover { transform: scale(1.2); background: #fff; }
    .wish-btn i { color: #e91e63; font-size: 14px; transition: transform .2s; }
    .wish-btn:hover i { transform: scale(1.2); }

    /* Quick view overlay */
    .prod-overlay {
      position: absolute; inset: 0; z-index: 2;
      background: rgba(15,28,20,.5);
      display: flex; align-items: center; justify-content: center;
      opacity: 0; transition: opacity .3s;
    }
    .prod-card:hover .prod-overlay { opacity: 1; }
    .prod-overlay a {
      background: #fff; color: var(--green);
      padding: 10px 22px; border-radius: 50px;
      font-size: 13px; font-weight: 700;
      text-decoration: none; letter-spacing: .3px;
      transform: translateY(8px); transition: transform .3s;
      font-family: 'Satoshi', sans-serif;
    }
    .prod-card:hover .prod-overlay a { transform: translateY(0); }

    /* Body */
    .prod-body { padding: 16px 16px 18px; display: flex; flex-direction: column; flex: 1; }

    .prod-name {
      font-size: 15px; font-weight: 600; color: var(--text);
      margin-bottom: 6px; line-height: 1.4;
      display: -webkit-box; -webkit-line-clamp: 2;
      -webkit-box-orient: vertical; overflow: hidden;
    }
    .prod-price-row { display: flex; align-items: center; gap: 8px; margin-bottom: 14px; }
    .prod-price {
      font-size: 22px; font-weight: 800;
      color: var(--green); letter-spacing: -0.5px;
    }

    /* Quantity + Cart */
    .prod-actions { display: flex; align-items: center; gap: 10px; margin-top: auto; }

    .qty-ctrl {
      display: flex; align-items: center;
      border: 2px solid var(--border); border-radius: var(--r-sm);
      overflow: hidden; flex-shrink: 0;
      background: var(--bg);
    }
    .qty-btn {
      background: none; border: none;
      width: 32px; height: 40px; cursor: pointer;
      font-size: 18px; font-weight: 700; color: var(--text-mid);
      display: flex; align-items: center; justify-content: center;
      transition: background .15s, color .15s;
    }
    .qty-btn:hover { background: var(--green-pale); color: var(--green); }
    .qty-input {
      width: 34px; height: 40px; text-align: center;
      border: none; border-left: 1.5px solid var(--border);
      border-right: 1.5px solid var(--border);
      font-size: 14px; font-weight: 700; color: var(--text);
      background: #fff; outline: none;
      font-family: 'Satoshi', sans-serif;
      -moz-appearance: textfield;
    }
    .qty-input::-webkit-outer-spin-button,
    .qty-input::-webkit-inner-spin-button { -webkit-appearance: none; }

    .cart-btn {
      flex: 1; background: var(--green); color: #fff;
      border: none; border-radius: var(--r-sm);
      height: 44px; font-size: 13px; font-weight: 700;
      font-family: 'Satoshi', sans-serif; cursor: pointer;
      display: flex; align-items: center; justify-content: center; gap: 7px;
      transition: background .2s, transform .15s, box-shadow .2s;
      letter-spacing: .2px; white-space: nowrap;
      box-shadow: 0 4px 12px rgba(26,107,58,.25);
    }
    .cart-btn:hover {
      background: var(--green-mid);
      transform: translateY(-1px);
      box-shadow: 0 6px 18px rgba(26,107,58,.35);
    }
    .cart-btn:active { transform: scale(.97); }
    .cart-btn i { font-size: 14px; }

    /* Added to cart animation */
    .cart-btn.added { background: #16a34a; }
    .cart-btn.added::after { content: ' âœ“'; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       EMPTY STATE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .empty-state {
      text-align: center; padding: 100px 24px;
    }
    .empty-icon { font-size: 72px; margin-bottom: 20px; opacity: .8; }
    .empty-state h3 {
      font-family: 'Clash Display', sans-serif;
      font-size: 26px; color: var(--text); margin-bottom: 10px;
    }
    .empty-state p { font-size: 16px; color: var(--text-soft); margin-bottom: 28px; }
    .empty-btn {
      display: inline-flex; align-items: center; gap: 8px;
      background: var(--green); color: #fff;
      padding: 13px 32px; border-radius: 50px;
      text-decoration: none; font-weight: 700; font-size: 15px;
      transition: background .2s, transform .2s;
      box-shadow: 0 6px 20px rgba(26,107,58,.3);
    }
    .empty-btn:hover { background: var(--green-mid); transform: translateY(-2px); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PAGINATION
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .pagination {
      display: flex; justify-content: center; align-items: center;
      gap: 8px; margin-top: 52px;
    }
    .page-link, .page-current {
      display: flex; align-items: center; justify-content: center;
      width: 44px; height: 44px; border-radius: 50%;
      font-size: 14px; font-weight: 700; text-decoration: none;
      transition: all .2s; font-family: 'Satoshi', sans-serif;
    }
    .page-link {
      background: var(--surface); color: var(--text-mid);
      border: 2px solid var(--border);
      box-shadow: var(--shadow-sm);
    }
    .page-link:hover {
      background: var(--green-pale); color: var(--green);
      border-color: var(--green); transform: translateY(-2px);
    }
    .page-current { background: var(--green); color: #fff; border: 2px solid var(--green); }
    .page-dots { color: var(--text-soft); font-size: 18px; padding: 0 4px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TOAST NOTIFICATION
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .toast {
      position: fixed; bottom: 28px; right: 28px; z-index: 999;
      background: var(--text); color: #fff;
      padding: 14px 22px; border-radius: var(--r-md);
      font-size: 14px; font-weight: 600;
      display: flex; align-items: center; gap: 10px;
      box-shadow: 0 8px 32px rgba(0,0,0,.25);
      transform: translateY(80px); opacity: 0;
      transition: transform .35s cubic-bezier(.34,1.56,.64,1), opacity .3s;
      pointer-events: none;
    }
    .toast.show { transform: translateY(0); opacity: 1; }
    .toast i { color: var(--green-light); font-size: 16px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       RESPONSIVE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    @media (max-width: 768px) {
      .navbar { padding: 0 16px; }
      .hero { padding: 36px 16px 44px; }
      .hero-stats { display: none; }
      .controls-wrap, .grid-wrap { padding-left: 16px; padding-right: 16px; }
      .search-input { width: 180px; }
      .product-grid { grid-template-columns: repeat(2, 1fr); gap: 14px; }
      .hero-icon { width: 60px; height: 60px; font-size: 30px; border-radius: 18px; }
    }
    @media (max-width: 480px) {
      .product-grid { grid-template-columns: repeat(2, 1fr); gap: 10px; }
      .prod-body { padding: 12px; }
      .prod-price { font-size: 18px; }
      .controls { flex-direction: column; align-items: stretch; }
      .controls-left { flex-direction: column; align-items: stretch; }
      .search-form { width: 100%; }
      .search-input { width: 100%; flex: 1; border-radius: var(--r-sm) 0 0 var(--r-sm); }
    }
  </style>
</head>
<body>

<!-- â•â•â• NAVBAR â•â•â• -->
<nav class="navbar">
  <a href="{% url 'shop:home' %}" class="nav-logo">
  Venodza
  </a>
  <div class="nav-right">
    <a href="{% url 'shop:home' %}" class="nav-btn nav-btn-ghost">
      <i class="fas fa-home"></i> Home
    </a>
    <a href="{% url 'shop:wishlist' %}" class="nav-btn nav-btn-ghost">
      <i class="fas fa-heart"></i> Wishlist
    </a>
    <a href="{% url 'shop:cart' %}" class="nav-btn nav-btn-primary">
      <i class="fas fa-shopping-bag"></i> Cart
    </a>
  </div>
</nav>

<!-- â•â•â• HERO â•â•â• -->
<section class="hero">
  <div class="hero-inner">
    <div class="breadcrumb">
      <a href="{% url 'shop:home' %}"><i class="fas fa-home" style="font-size:11px;"></i> Home</a>
      <span class="breadcrumb-sep">â€º</span>
      <span>{{ category_name }}</span>
    </div>
    <div class="hero-content">
      <div class="hero-icon">{{ category_icon }}</div>
      <div class="hero-text">
        <h1>{{ category_name }}</h1>
        <p>Fresh products, best quality, great prices</p>
        <div class="hero-stats">
          <div class="hero-stat">
            <strong>{{ product_count }}</strong>
            <span>Products</span>
          </div>
          <div class="hero-stat">
            <strong>Free</strong>
            <span>Delivery</span>
          </div>
          <div class="hero-stat">
            <strong>100%</strong>
            <span>Fresh</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- â•â•â• CONTROLS â•â•â• -->
<div class="controls-wrap">
  <form method="get" action="" class="search-form" id="filterForm">
    <div class="controls">
      <div class="controls-left">
        <span class="count-badge">
          <i class="fas fa-box-open" style="margin-right:5px;"></i>
          {{ product_count }} products
        </span>
        <div class="search-wrap">
          <i class="fas fa-search search-icon"></i>
          <input
            class="search-input"
            type="text" name="q"
            placeholder="Search in {{ category_name }}..."
            value="{{ search_query }}"
            id="searchInput"
          >
        </div>
        <button type="submit" class="search-submit">
          <i class="fas fa-search"></i> Search
        </button>
        {% if search_query %}
        <a href="?sort={{ current_sort }}"
           style="color:var(--text-soft);font-size:13px;text-decoration:none;display:flex;align-items:center;gap:5px;">
          <i class="fas fa-times-circle"></i> Clear
        </a>
        {% endif %}
      </div>
      <select class="sort-select" name="sort" onchange="document.getElementById('filterForm').submit()">
        <option value="-created_at" {% if current_sort == '-created_at' %}selected{% endif %}>â° Newest First</option>
        <option value="price"       {% if current_sort == 'price' %}selected{% endif %}>ğŸ’° Price: Low â†’ High</option>
        <option value="-price"      {% if current_sort == '-price' %}selected{% endif %}>ğŸ’ Price: High â†’ Low</option>
        <option value="name"        {% if current_sort == 'name' %}selected{% endif %}>ğŸ”¤ Name: A â†’ Z</option>
        <option value="-name"       {% if current_sort == '-name' %}selected{% endif %}>ğŸ”¤ Name: Z â†’ A</option>
      </select>
    </div>
    <input type="hidden" name="sort" id="hiddenSort" value="{{ current_sort }}">
  </form>
</div>

<!-- â•â•â• PRODUCT GRID â•â•â• -->
<div class="grid-wrap">
  {% if products %}
  <div class="product-grid">
    {% for product in products %}
    <div class="prod-card">

      <!-- Image -->
      <div class="prod-img">
        {% if product.image %}
          <img src="{{ product.image.url }}" alt="{{ product.name }}" loading="lazy">
        {% else %}
          <img src="https://placehold.co/400x400/e8f5e9/1a6b3a?text={{ product.name|urlencode }}" alt="{{ product.name }}">
        {% endif %}

        <span class="prod-badge">New</span>

        {% if user.is_authenticated %}
        <form method="post" action="{% url 'shop:wishlist' %}" class="wish-form">
          {% csrf_token %}
          <input type="hidden" name="product_id" value="{{ product.id }}">
          <button type="submit" class="wish-btn" title="Add to Wishlist">
            <i class="fas fa-heart"></i>
          </button>
        </form>
        {% endif %}

        <!-- Quick view -->
        <div class="prod-overlay">
          <a href="{% url 'shop:product_detail' product.id %}">
            <i class="fas fa-eye" style="margin-right:6px;"></i> Quick View
          </a>
        </div>
      </div>

      <!-- Body -->
      <div class="prod-body">
        <p class="prod-name">{{ product.name }}</p>
        <div class="prod-price-row">
          <span class="prod-price">${{ product.price }}</span>
        </div>

        <form method="post" action="{% url 'shop:cart' %}" class="prod-actions" onsubmit="handleCart(event, this)">
          {% csrf_token %}
          <input type="hidden" name="product_id" value="{{ product.id }}">

          <div class="qty-ctrl">
            <button type="button" class="qty-btn" onclick="changeQty(this, -1)">âˆ’</button>
            <input type="number" class="qty-input" name="quantity" value="1" min="1" max="99">
            <button type="button" class="qty-btn" onclick="changeQty(this, 1)">+</button>
          </div>

          <button type="submit" class="cart-btn">
            <i class="fas fa-cart-plus"></i> Add to Cart
          </button>
        </form>
      </div>

    </div>
    {% endfor %}
  </div>

  <!-- PAGINATION -->
  {% if products.has_other_pages %}
  <div class="pagination">
    {% if products.has_previous %}
      <a class="page-link" href="?page={{ products.previous_page_number }}&sort={{ current_sort }}&q={{ search_query }}">
        <i class="fas fa-chevron-left" style="font-size:12px;"></i>
      </a>
    {% endif %}

    {% for num in products.paginator.page_range %}
      {% if products.number == num %}
        <span class="page-current">{{ num }}</span>
      {% elif num > products.number|add:'-3' and num < products.number|add:'3' %}
        <a class="page-link" href="?page={{ num }}&sort={{ current_sort }}&q={{ search_query }}">{{ num }}</a>
      {% endif %}
    {% endfor %}

    {% if products.has_next %}
      <a class="page-link" href="?page={{ products.next_page_number }}&sort={{ current_sort }}&q={{ search_query }}">
        <i class="fas fa-chevron-right" style="font-size:12px;"></i>
      </a>
    {% endif %}
  </div>
  {% endif %}

  {% else %}
  <!-- EMPTY STATE -->
  <div class="empty-state">
    <div class="empty-icon">{{ category_icon }}</div>
    <h3>No products in {{ category_name }}</h3>
    <p>We're stocking up this category. Check back soon!</p>
    <a href="{% url 'shop:home' %}" class="empty-btn">
      <i class="fas fa-arrow-left"></i> Back to Home
    </a>
  </div>
  {% endif %}
</div>

<!-- TOAST -->
<div class="toast" id="toast">
  <i class="fas fa-check-circle"></i>
  <span id="toastMsg">Added to cart!</span>
</div>

<script>
  /* â”€â”€ Quantity control â”€â”€ */
  function changeQty(btn, delta) {
    const input = btn.closest('.qty-ctrl').querySelector('.qty-input');
    const val = parseInt(input.value) + delta;
    if (val >= 1 && val <= 99) input.value = val;
  }

  /* â”€â”€ Add to cart with toast â”€â”€ */
  function handleCart(e, form) {
    e.preventDefault();
    const btn = form.querySelector('.cart-btn');
    const productName = form.closest('.prod-card').querySelector('.prod-name').textContent.trim();

    // Visual feedback on button
    btn.classList.add('added');
    btn.innerHTML = '<i class="fas fa-check"></i> Added!';
    btn.style.background = '#16a34a';

    setTimeout(() => {
      btn.classList.remove('added');
      btn.innerHTML = '<i class="fas fa-cart-plus"></i> Add to Cart';
      btn.style.background = '';
    }, 2000);

    // Show toast
    showToast(`"${productName.substring(0, 28)}${productName.length > 28 ? 'â€¦' : ''}" added to cart!`);

    // Submit the actual form
    form.submit();
  }

  /* â”€â”€ Toast helper â”€â”€ */
  function showToast(msg) {
    const toast = document.getElementById('toast');
    document.getElementById('toastMsg').textContent = msg;
    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 3000);
  }

  /* â”€â”€ Search on Enter â”€â”€ */
  document.getElementById('searchInput').addEventListener('keydown', function(e) {
    if (e.key === 'Enter') {
      e.preventDefault();
      document.getElementById('filterForm').submit();
    }
  });

  /* â”€â”€ Fix hidden sort input conflict â”€â”€ */
  const sortSelect = document.querySelector('.sort-select');
  const hiddenSort = document.getElementById('hiddenSort');
  if (sortSelect && hiddenSort) {
    hiddenSort.remove(); // avoid duplicate sort param
  }
</script>





</body>
</html>