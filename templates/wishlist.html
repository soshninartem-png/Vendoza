{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wishlist ‚Äî Vendoza</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Nunito+Sans:wght@400;600;700&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
:root {
  --green:        #3DBF6C;
  --green-dark:   #2ea858;
  --green-light:  #e8f9f0;
  --gold:         #F5C842;
  --dark:         #1a1a1a;
  --text-main:    #222222;
  --text-sub:     #6B7280;
  --border:       #E5E7EB;
  --bg:           #F5F6FA;
  --white:        #FFFFFF;
  --sidebar-w:    220px;
  --shadow-sm:    0 1px 4px rgba(0,0,0,0.07);
  --shadow-md:    0 4px 16px rgba(0,0,0,0.09);
  --radius:       10px;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text-main);min-height:100vh;-webkit-font-smoothing:antialiased;}
form{margin:0;}
input[type="hidden"]{display:none;}
a{text-decoration:none;}

/* LAYOUT */
.layout{display:flex;min-height:100vh;}

/* SIDEBAR */
.sidebar{width:var(--sidebar-w);background:var(--white);border-right:1px solid var(--border);display:flex;flex-direction:column;position:fixed;top:0;left:0;bottom:0;z-index:100;padding-bottom:24px;}
.sidebar-logo{padding:22px 20px 18px;border-bottom:1px solid var(--border);font-size:1.2rem;font-weight:800;color:var(--green);display:flex;align-items:center;gap:8px;}
.sidebar-logo .dot{width:9px;height:9px;border-radius:50%;background:var(--gold);}
.sidebar-nav{flex:1;padding:10px 0;}
.nav-item{display:flex;align-items:center;gap:12px;padding:11px 20px;font-size:.88rem;font-weight:500;color:var(--text-sub);text-decoration:none;transition:all .2s;position:relative;}
.nav-item i{width:18px;text-align:center;font-size:.95rem;}
.nav-item:hover{color:var(--text-main);background:var(--bg);}
.nav-item.active{color:var(--green);font-weight:600;background:var(--green-light);}
.nav-item.active::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--green);border-radius:0 4px 4px 0;}
.sidebar-bottom{padding:0 12px;margin-top:auto;}
.btn-sidebar-action{width:100%;padding:13px;background:var(--green);border:none;border-radius:var(--radius);font-family:'Inter',sans-serif;font-size:.88rem;font-weight:700;color:#fff;cursor:pointer;transition:all .25s;display:flex;align-items:center;justify-content:center;gap:8px;}
.btn-sidebar-action:hover{background:var(--green-dark);transform:translateY(-1px);box-shadow:0 4px 14px rgba(61,191,108,.35);}

/* TOPBAR */
.topbar{position:fixed;top:0;left:var(--sidebar-w);right:0;height:64px;background:var(--white);border-bottom:1px solid var(--border);display:flex;align-items:center;padding:0 24px;gap:16px;z-index:90;}
.search-bar-inner{display:flex;align-items:center;background:var(--bg);border:1.5px solid var(--border);border-radius:10px;overflow:hidden;height:42px;transition:border-color .2s;flex:1;max-width:560px;}
.search-bar-inner:focus-within{border-color:var(--green);box-shadow:0 0 0 3px rgba(61,191,108,.1);}
.search-cat-select{border:none;background:transparent;font-family:'Inter',sans-serif;font-size:.82rem;font-weight:500;color:var(--text-main);padding:0 10px 0 12px;outline:none;cursor:pointer;min-width:120px;}
.search-divider{width:1px;height:22px;background:var(--border);flex-shrink:0;}
.search-text-input{flex:1;border:none;background:transparent;font-family:'Inter',sans-serif;font-size:.88rem;color:var(--text-main);padding:0 12px;outline:none;min-width:0;}
.search-text-input::placeholder{color:var(--text-sub);}
.search-submit-btn{width:42px;height:42px;border:none;background:var(--green);color:#fff;font-size:.88rem;cursor:pointer;transition:background .2s;flex-shrink:0;display:flex;align-items:center;justify-content:center;}
.search-submit-btn:hover{background:var(--green-dark);}
.topbar-right{margin-left:auto;display:flex;align-items:center;gap:10px;}
.topbar-icon-btn{width:38px;height:38px;border-radius:9px;border:1.5px solid var(--border);background:var(--white);display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--text-sub);transition:all .2s;font-size:.95rem;text-decoration:none;}
.topbar-icon-btn:hover,.topbar-icon-btn.active-icon{border-color:var(--green);color:var(--green);background:var(--green-light);}
.btn-start-selling{padding:9px 20px;background:var(--green);color:#fff;border:none;border-radius:9px;font-family:'Inter',sans-serif;font-size:.85rem;font-weight:600;cursor:pointer;transition:all .2s;white-space:nowrap;}
.btn-start-selling:hover{background:var(--green-dark);transform:translateY(-1px);}
.offcanvas-menu-link{display:flex;align-items:center;gap:10px;padding:11px 14px;background:#fff;color:var(--text-main);text-decoration:none;font-size:.9rem;font-weight:500;border-radius:10px;border:1px solid var(--border);transition:all .2s;}
.offcanvas-menu-link:hover{background:var(--green-light);border-color:var(--green);color:var(--green);}

/* MAIN */
.main-content{margin-left:var(--sidebar-w);margin-top:64px;padding:28px 32px;min-height:calc(100vh - 64px);flex:1;}

/* TOOLBAR */
.wishlist-toolbar{display:flex;align-items:center;gap:14px;margin-bottom:20px;flex-wrap:wrap;}
.wishlist-title{font-size:1.35rem;font-weight:700;letter-spacing:-.3px;}
.badge-count{background:var(--green-light);color:var(--green);border:1px solid rgba(61,191,108,.25);padding:4px 12px;border-radius:50px;font-size:.8rem;font-weight:700;}
.wishlist-search-wrap{position:relative;display:flex;align-items:center;flex:1;max-width:380px;}
.wishlist-search-icon{position:absolute;left:12px;color:var(--text-sub);font-size:.85rem;pointer-events:none;}
.wishlist-search-input{width:100%;height:38px;padding:0 36px;border:1.5px solid var(--border);border-radius:9px;background:#fff;font-family:'Inter',sans-serif;font-size:.88rem;color:var(--text-main);outline:none;transition:all .25s;}
.wishlist-search-input:focus{border-color:var(--green);box-shadow:0 0 0 3px rgba(61,191,108,.12);}
.wishlist-search-input::placeholder{color:var(--text-sub);}
.wishlist-search-clear{position:absolute;right:10px;background:none;border:none;color:var(--text-sub);font-size:.82rem;cursor:pointer;padding:4px;transition:color .2s;display:none;}
.wishlist-search-clear:hover{color:#ef4444;}
.wishlist-filter-select,.sort-select{padding:7px 14px;border:1.5px solid var(--border);border-radius:8px;background:#fff;font-family:'Inter',sans-serif;font-size:.85rem;color:var(--text-main);cursor:pointer;outline:none;transition:border .2s;}
.wishlist-filter-select:focus,.sort-select:focus{border-color:var(--green);}
.toolbar-view-btns{display:flex;gap:4px;}
.view-btn{width:34px;height:34px;border-radius:7px;border:1.5px solid var(--border);background:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--text-sub);font-size:.9rem;transition:all .2s;}
.view-btn.active,.view-btn:hover{border-color:var(--green);color:var(--green);background:var(--green-light);}

/* TABS */
.wishlist-tabs{display:flex;border-bottom:2px solid var(--border);margin-bottom:28px;}
.tab{padding:10px 20px;font-size:.88rem;font-weight:600;color:var(--text-sub);cursor:pointer;border-bottom:2px solid transparent;margin-bottom:-2px;display:flex;align-items:center;gap:7px;transition:all .2s;}
.tab.active{color:var(--text-main);border-bottom-color:var(--dark);}

/* GRID */
.products-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:20px;animation:fadeIn .5s ease;}

/* CARD */
.product-card{background:#fff;border-radius:var(--radius);overflow:hidden;border:1px solid var(--border);transition:all .25s cubic-bezier(.4,0,.2,1);position:relative;animation:fadeInUp .5s ease backwards;}
.product-card:nth-child(1){animation-delay:.05s}
.product-card:nth-child(2){animation-delay:.10s}
.product-card:nth-child(3){animation-delay:.15s}
.product-card:nth-child(4){animation-delay:.20s}
.product-card:nth-child(5){animation-delay:.25s}
.product-card:nth-child(6){animation-delay:.30s}
.product-card:hover{border-color:#d1d5db;box-shadow:var(--shadow-md);transform:translateY(-3px);}

.product-image-container{position:relative;width:100%;aspect-ratio:1;background:#f3f4f6;overflow:hidden;display:flex;align-items:center;justify-content:center;}
.product-image{width:100%;height:100%;object-fit:cover;transition:transform .4s cubic-bezier(.4,0,.2,1);}
.product-card:hover .product-image{transform:scale(1.05);}

/* Heart (remove from wishlist) ‚Äî top right of image */
.wishlist-heart-btn{position:absolute;top:10px;right:10px;width:34px;height:34px;background:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;color:var(--gold);font-size:.95rem;box-shadow:var(--shadow-sm);z-index:2;cursor:pointer;transition:all .25s;border:none;}
.wishlist-heart-btn:hover{transform:scale(1.18);color:#e91e63;background:#fce4ec;}

.card-meta-badges{position:absolute;bottom:10px;left:10px;right:10px;display:flex;align-items:center;justify-content:space-between;gap:6px;}
.badge-location{display:flex;align-items:center;gap:4px;background:rgba(255,255,255,.92);backdrop-filter:blur(6px);padding:4px 9px;border-radius:6px;font-size:.72rem;color:var(--text-sub);font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:70%;}
.badge-location i{color:var(--green);font-size:.7rem;}
.badge-date{background:rgba(255,255,255,.92);backdrop-filter:blur(6px);padding:4px 9px;border-radius:6px;font-size:.72rem;color:var(--text-sub);font-weight:500;white-space:nowrap;}

/* Card Body */
.card-body{padding:14px 16px 16px;}
.product-name{font-family:'Nunito Sans',sans-serif;font-size:.95rem;font-weight:600;color:var(--text-main);margin-bottom:6px;line-height:1.35;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.product-price-row{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:0;}
.product-price{font-family:'Nunito Sans',sans-serif;font-size:1.18rem;font-weight:700;color:var(--text-main);letter-spacing:-.3px;}
.price-view-link{width:32px;height:32px;background:var(--green-light);border-radius:50%;display:flex;align-items:center;justify-content:center;color:var(--green);font-size:.85rem;text-decoration:none;transition:all .2s;flex-shrink:0;}
.price-view-link:hover{background:var(--green);color:#fff;}

/* Card Actions */
.card-actions{display:flex;gap:8px;margin-top:12px;align-items:center;}
.qty-ctrl{display:flex;align-items:center;border:1.5px solid var(--border);border-radius:8px;overflow:hidden;flex-shrink:0;background:var(--bg);}
.qty-ctrl button{background:none;border:none;width:28px;height:36px;cursor:pointer;font-size:16px;font-weight:700;color:var(--text-sub);display:flex;align-items:center;justify-content:center;transition:background .15s,color .15s;}
.qty-ctrl button:hover{background:var(--green-light);color:var(--green);}
.qty-ctrl input{width:30px;height:36px;text-align:center;border:none;border-left:1px solid var(--border);border-right:1px solid var(--border);font-size:.85rem;font-weight:700;color:var(--text-main);background:#fff;outline:none;font-family:'Inter',sans-serif;-moz-appearance:textfield;}
.qty-ctrl input::-webkit-outer-spin-button,.qty-ctrl input::-webkit-inner-spin-button{-webkit-appearance:none;}
.btn-cart{flex:1;height:38px;background:var(--green);color:#fff;border:none;border-radius:8px;font-family:'Inter',sans-serif;font-size:.8rem;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px;transition:all .25s;letter-spacing:.2px;}
.btn-cart:hover{background:var(--green-dark);transform:translateY(-1px);box-shadow:0 4px 12px rgba(61,191,108,.35);}
.btn-cart.added{background:#16a34a;}
.btn-remove{width:38px;height:38px;background:#fff;border:1.5px solid var(--border);border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:.88rem;color:var(--text-sub);transition:all .2s;flex-shrink:0;}
.btn-remove:hover{background:#fef2f2;border-color:#ef4444;color:#ef4444;}
.btn-view-link{width:38px;height:38px;background:var(--bg);border:1.5px solid var(--border);border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:.85rem;color:var(--text-sub);transition:all .2s;text-decoration:none;flex-shrink:0;}
.btn-view-link:hover{background:var(--green-light);border-color:var(--green);color:var(--green);}

/* EMPTY */
.empty-wishlist{text-align:center;padding:100px 40px;animation:fadeIn .6s ease;}
.empty-icon{font-size:5rem;color:var(--green);margin-bottom:28px;opacity:.25;}
.empty-wishlist h2{font-family:'Nunito Sans',sans-serif;font-size:1.8rem;font-weight:700;color:var(--text-main);margin-bottom:12px;}
.empty-wishlist p{font-size:.98rem;color:var(--text-sub);margin-bottom:32px;max-width:400px;margin-left:auto;margin-right:auto;line-height:1.7;}
.btn-discover{display:inline-flex;align-items:center;gap:10px;padding:13px 36px;background:var(--green);color:#fff;text-decoration:none;font-family:'Inter',sans-serif;font-size:.92rem;font-weight:600;border-radius:10px;transition:all .25s;}
.btn-discover:hover{background:var(--green-dark);transform:translateY(-2px);box-shadow:0 6px 20px rgba(61,191,108,.35);}

/* NO RESULTS */
.no-results-msg{display:none;text-align:center;padding:80px 20px;color:var(--text-sub);}
.no-results-msg i{font-size:3rem;margin-bottom:16px;opacity:.3;display:block;}

/* TOAST */
.toast-msg{position:fixed;bottom:24px;right:24px;z-index:999;background:#1a1a1a;color:#fff;padding:13px 20px;border-radius:12px;font-size:14px;font-weight:600;display:flex;align-items:center;gap:10px;box-shadow:0 8px 32px rgba(0,0,0,.22);transform:translateY(80px);opacity:0;transition:transform .35s cubic-bezier(.34,1.56,.64,1),opacity .3s;pointer-events:none;max-width:320px;}
.toast-msg.show{transform:translateY(0);opacity:1;}
.toast-msg i{color:#4ade80;font-size:16px;flex-shrink:0;}

@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes fadeInUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}

/* RESPONSIVE */
@media(max-width:900px){
  :root{--sidebar-w:0px;}
  .sidebar{display:none;}
  .topbar{left:0;padding:0 14px;height:56px;}
  .main-content{margin-left:0;margin-top:56px;padding:16px 14px;}
  .products-grid{grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:14px;}
}
@media(max-width:640px){
  .topbar{height:52px;padding:0 12px;gap:8px;}
  .search-cat-select,.search-divider{display:none;}
  .search-bar-inner{height:38px;}
  .search-text-input{font-size:.82rem;padding:0 8px;}
  .search-submit-btn{width:38px;height:38px;}
  .main-content{margin-top:52px;padding:14px 12px;padding-bottom:76px;}
  .wishlist-toolbar{flex-wrap:wrap;gap:10px;margin-bottom:14px;}
  .wishlist-title{font-size:1.15rem;}
  .wishlist-search-wrap{order:3;max-width:100%;width:100%;flex:unset;}
  .products-grid{grid-template-columns:1fr 1fr;gap:10px;}
  .card-body{padding:10px 10px 12px;}
  .product-name{font-size:.82rem;}
  .product-price{font-size:1rem;}
  .card-actions{gap:5px;}
  .btn-cart{font-size:.72rem;height:34px;}
  .bottom-nav{display:flex!important;}
}

/* BOTTOM NAV */
.bottom-nav{display:none;position:fixed;bottom:0;left:0;right:0;height:60px;background:#fff;border-top:1px solid var(--border);z-index:200;align-items:center;justify-content:space-around;padding:0 8px;box-shadow:0 -4px 16px rgba(0,0,0,.07);}
.bottom-nav-item{display:flex;flex-direction:column;align-items:center;gap:3px;text-decoration:none;color:var(--text-sub);font-size:.62rem;font-weight:500;padding:6px 12px;border-radius:10px;transition:all .2s;min-width:52px;}
.bottom-nav-item i{font-size:1.1rem;}
.bottom-nav-item.active{color:var(--green);background:var(--green-light);}
.bottom-nav-item:hover{color:var(--green);}
</style>
</head>
<body>

<!-- TOAST -->
<div class="toast-msg" id="toast">
  <i class="fas fa-check-circle"></i>
  <span id="toastText">Added to cart!</span>
</div>

<div class="layout">

<!-- ‚ïê‚ïê SIDEBAR ‚ïê‚ïê -->
<aside class="sidebar">
  <div class="sidebar-logo">
    <div class="dot"></div> Vendoza
  </div>
  <nav class="sidebar-nav">
    <a href="{% url 'shop:home' %}" class="nav-item">
      <i class="fas fa-house"></i> Home
    </a>
    <a href="{% url 'shop:wishlist' %}" class="nav-item active">
      <i class="fas fa-heart"></i> Wishlist
    </a>
    <a href="{% url 'shop:cart' %}" class="nav-item">
      <i class="fas fa-shopping-bag"></i> Cart
    </a>
    <a href="{% url 'shop:moizakazu' %}" class="nav-item">
      <i class="fas fa-box"></i> My Orders
    </a>
    {% if user.is_authenticated %}
    <a href="{% url 'shop:profile_edit' %}" class="nav-item">
      <i class="fas fa-user"></i> Profile
    </a>
    {% endif %}
  </nav>
  <div class="sidebar-bottom">
    <a href="{% url 'shop:home' %}" class="btn-sidebar-action">
      <i class="fas fa-store"></i> Browse Shop
    </a>
  </div>
</aside>

<!-- ‚ïê‚ïê TOPBAR ‚ïê‚ïê -->
<header class="topbar">
  <form method="get" action="{% url 'shop:search' %}" style="flex:1;max-width:560px;">
    <div class="search-bar-inner">
      <select name="category" class="search-cat-select">
        <option value="">All Categories</option>
        {% for cat in categories %}
        <option value="{{ cat.slug }}">{{ cat.name }}</option>
        {% endfor %}
      </select>
      <div class="search-divider"></div>
      <input type="text" name="q" class="search-text-input"
             placeholder="Search products..."
             value="{{ request.GET.q|default:'' }}">
      <button type="submit" class="search-submit-btn">
        <i class="fas fa-search"></i>
      </button>
    </div>
  </form>

  <div class="topbar-right">
    <button class="btn-start-selling" onclick="window.location='{% url 'shop:create_tovar' %}'">Start Selling</button>

    <!-- Profile offcanvas trigger -->
    <button class="topbar-icon-btn" data-bs-toggle="offcanvas" data-bs-target="#offcanvasProfile">
      <i class="fas fa-user"></i>
    </button>

    <a href="{% url 'shop:wishlist' %}" class="topbar-icon-btn active-icon" title="Wishlist">
      <i class="fas fa-heart"></i>
    </a>
    <a href="{% url 'shop:cart' %}" class="topbar-icon-btn" title="Cart">
      <i class="fas fa-shopping-bag"></i>
    </a>
  </div>
</header>

<!-- ‚ïê‚ïê OFFCANVAS PROFILE ‚ïê‚ïê -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasProfile" style="width:360px;">
  <div class="offcanvas-header border-bottom">
    <h5 class="offcanvas-title fw-bold">Profile</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
  </div>
  <div class="offcanvas-body">
    {% if user.is_authenticated %}
    <div class="d-flex align-items-center gap-3 mb-4">
      <div class="rounded-circle bg-light d-flex align-items-center justify-content-center"
           style="width:56px;height:56px;font-size:22px;background:var(--green-light)!important;">
        <i class="fas fa-user" style="color:var(--green);"></i>
      </div>
      <div>
        <strong>{{ user.username }}</strong><br>
        <small class="text-muted">{{ user.email }}</small>
      </div>
    </div>
    <div class="d-flex flex-column gap-2">
      <a href="{% url 'shop:balance' %}" class="offcanvas-menu-link">üí∞ Top up balance</a>
      <a href="{% url 'shop:courier_page' %}" class="offcanvas-menu-link">üßë‚Äçüö¥ Become a courier</a>
      <a href="{% url 'shop:moizakazu' %}" class="offcanvas-menu-link">üõí My orders</a>
      <a href="{% url 'shop:create_tovar' %}" class="offcanvas-menu-link">‚ûï Add product</a>
      <a href="{% url 'shop:profile_edit' %}" class="offcanvas-menu-link">‚úèÔ∏è Edit profile</a>
    </div>
    <hr>
    <a href="{% url 'shop:logout' %}" class="btn btn-outline-danger w-100 mt-2">
      <i class="fas fa-sign-out-alt me-2"></i>Logout
    </a>
    {% else %}
    <p class="text-muted mb-3">You are not logged in</p>
    <div class="d-flex flex-column gap-2">
      <a href="{% url 'shop:login' %}" class="btn btn-success w-100">Login</a>
      <a href="{% url 'shop:signup' %}" class="btn btn-outline-secondary w-100">Register</a>
    </div>
    {% endif %}
  </div>
</div>

<!-- ‚ïê‚ïê MAIN ‚ïê‚ïê -->
<main class="main-content">

  <!-- TOOLBAR -->
  <div class="wishlist-toolbar">
    <h1 class="wishlist-title">My Wishlist</h1>
    {% if wishlist_items %}
    <span class="badge-count">
      <i class="fas fa-heart" style="margin-right:4px;font-size:10px;"></i>
      {{ wishlist_items|length }} saved
    </span>
    {% endif %}

    <!-- Live search inside wishlist -->
    {% if wishlist_items %}
    <div class="wishlist-search-wrap">
      <i class="fas fa-search wishlist-search-icon"></i>
      <input type="text" id="wishlistSearch" class="wishlist-search-input"
             placeholder="Search in wishlist..." autocomplete="off">
      <button class="wishlist-search-clear" id="clearSearch" title="Clear">
        <i class="fas fa-times"></i>
      </button>
    </div>
    {% endif %}

    <div class="toolbar-view-btns" style="margin-left:auto;">
      <button class="view-btn" id="viewList" title="List view"><i class="fas fa-list"></i></button>
      <button class="view-btn active" id="viewGrid" title="Grid view"><i class="fas fa-grip"></i></button>
    </div>
  </div>

  <!-- TABS -->
  <div class="wishlist-tabs">
    <div class="tab active">
      <i class="fas fa-heart" style="color:#F5C842;"></i> Saved Items
    </div>
    <div class="tab">
      <i class="fas fa-clock" style="color:#6B7280;"></i> Recently Added
    </div>
  </div>

  {% if wishlist_items %}
  <div class="products-grid" id="wishlistGrid">
    {% for item in wishlist_items %}
    <div class="product-card" data-name="{{ item.product.name|lower }}">

      <!-- IMAGE -->
      <div class="product-image-container">
        {% if item.product.image %}
          <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" class="product-image" loading="lazy">
        {% else %}
          <img src="https://placehold.co/400x400/e8f9f0/2ea858?text={{ item.product.name|urlencode }}"
               alt="{{ item.product.name }}" class="product-image">
        {% endif %}

        <!-- REMOVE FROM WISHLIST (heart button top-right) -->
        <form method="POST" action="{% url 'shop:wishlist' %}"
              style="position:absolute;top:10px;right:10px;z-index:3;"
              onsubmit="animateRemove(event, this)">
          {% csrf_token %}
          <input type="hidden" name="product_id" value="{{ item.product.id }}">
          <button type="submit" class="wishlist-heart-btn" title="Remove from wishlist">
            <i class="fas fa-heart"></i>
          </button>
        </form>

        <!-- Meta badges -->
        <div class="card-meta-badges">
          <span class="badge-location">
            <i class="fas fa-location-dot"></i> Store
          </span>
          {% if item.added_at %}
          <span class="badge-date">{{ item.added_at|date:"d M" }}</span>
          {% endif %}
        </div>
      </div>

      <!-- BODY -->
      <div class="card-body">
        <div class="product-name" title="{{ item.product.name }}">{{ item.product.name }}</div>
        <div class="product-price-row">
          <div class="product-price">${{ item.product.price }}</div>
          <a href="{% url 'shop:product_detail' item.product.id %}" class="price-view-link" title="View product">
            <i class="fas fa-arrow-right"></i>
          </a>
        </div>

        <!-- ACTIONS: qty ctrl + add to cart + remove + view -->
        <div class="card-actions">

          <!-- Quantity controller -->
          <div class="qty-ctrl">
            <button type="button" onclick="qtyMinus(this)">‚àí</button>
            <input type="number" value="1" min="1" max="99" class="qty-val">
            <button type="button" onclick="qtyPlus(this)">+</button>
          </div>

          <!-- Add to Cart -->
          <form method="POST" action="{% url 'shop:cart' %}"
                style="flex:1;display:flex;"
                onsubmit="handleAddToCart(event, this)">
            {% csrf_token %}
            <input type="hidden" name="product_id" value="{{ item.product.id }}">
            <input type="hidden" name="quantity" value="1" class="qty-hidden">
            <button type="submit" class="btn-cart">
              <i class="fas fa-shopping-bag"></i> Add to Cart
            </button>
          </form>

          <!-- Remove (trash icon) -->
          <form method="POST" action="{% url 'shop:wishlist' %}"
                onsubmit="animateRemove(event, this)">
            {% csrf_token %}
            <input type="hidden" name="product_id" value="{{ item.product.id }}">
            <button type="submit" class="btn-remove" title="Remove from wishlist">
              <i class="fas fa-trash-alt"></i>
            </button>
          </form>

          <!-- View detail -->
          <a href="{% url 'shop:product_detail' item.product.id %}" class="btn-view-link" title="View details">
            <i class="fas fa-eye"></i>
          </a>

        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- No search results -->
  <div class="no-results-msg" id="noResults">
    <i class="fas fa-search"></i>
    <p>No products found</p>
  </div>

  {% else %}
  <!-- EMPTY STATE -->
  <div class="empty-wishlist">
    <div class="empty-icon"><i class="fas fa-heart-crack"></i></div>
    <h2>Your Wishlist is Empty</h2>
    <p>Start exploring our collection and save your favourite items here for easy access.</p>
    <a href="{% url 'shop:home' %}" class="btn-discover">
      <i class="fas fa-compass"></i> Discover Products
    </a>
  </div>
  {% endif %}

</main>

<!-- ‚ïê‚ïê BOTTOM NAV (mobile) ‚ïê‚ïê -->
<nav class="bottom-nav">
  <a href="{% url 'shop:home' %}" class="bottom-nav-item">
    <i class="fas fa-house"></i><span>Home</span>
  </a>
  <a href="{% url 'shop:wishlist' %}" class="bottom-nav-item active">
    <i class="fas fa-heart"></i><span>Wishlist</span>
  </a>
  <a href="{% url 'shop:cart' %}" class="bottom-nav-item">
    <i class="fas fa-shopping-bag"></i><span>Cart</span>
  </a>
  <a href="{% url 'shop:moizakazu' %}" class="bottom-nav-item">
    <i class="fas fa-box"></i><span>Orders</span>
  </a>
  {% if user.is_authenticated %}
  <a href="{% url 'shop:profile_edit' %}" class="bottom-nav-item">
    <i class="fas fa-user"></i><span>Profile</span>
  </a>
  {% else %}
  <a href="{% url 'shop:login' %}" class="bottom-nav-item">
    <i class="fas fa-sign-in-alt"></i><span>Login</span>
  </a>
  {% endif %}
</nav>

</div><!-- .layout -->

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   1. QUANTITY CONTROLS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function qtyMinus(btn) {
  const ctrl = btn.closest('.qty-ctrl');
  const input = ctrl.querySelector('.qty-val');
  const val = Math.max(1, parseInt(input.value) - 1);
  input.value = val;
  syncHidden(ctrl, val);
}
function qtyPlus(btn) {
  const ctrl = btn.closest('.qty-ctrl');
  const input = ctrl.querySelector('.qty-val');
  const val = Math.min(99, parseInt(input.value) + 1);
  input.value = val;
  syncHidden(ctrl, val);
}
function syncHidden(ctrl, val) {
  // find the hidden quantity input in the nearby cart form
  const actions = ctrl.closest('.card-actions');
  const hidden = actions.querySelector('.qty-hidden');
  if (hidden) hidden.value = val;
}
// Also sync on manual typing
document.querySelectorAll('.qty-val').forEach(inp => {
  inp.addEventListener('input', function() {
    const val = Math.min(99, Math.max(1, parseInt(this.value) || 1));
    this.value = val;
    syncHidden(this.closest('.qty-ctrl'), val);
  });
});

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   2. ADD TO CART ‚Äî sync qty then submit
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function handleAddToCart(e, form) {
  e.preventDefault();

  // sync qty one last time before submit
  const actions = form.closest('.card-actions');
  const qtyVal  = actions.querySelector('.qty-val');
  const hidden  = form.querySelector('.qty-hidden');
  if (qtyVal && hidden) hidden.value = qtyVal.value;

  // button feedback
  const btn  = form.querySelector('.btn-cart');
  const orig = btn.innerHTML;
  btn.classList.add('added');
  btn.innerHTML = '<i class="fas fa-check"></i> Added!';
  btn.disabled  = true;

  // toast
  const name = form.closest('.product-card').querySelector('.product-name').textContent.trim();
  showToast(`"${name.length > 28 ? name.substring(0,28)+'‚Ä¶' : name}" added to cart!`);

  setTimeout(() => {
    btn.classList.remove('added');
    btn.innerHTML = orig;
    btn.disabled  = false;
  }, 2000);

  form.submit();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   3. REMOVE FROM WISHLIST (animate card out)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function animateRemove(e, form) {
  e.preventDefault();
  const card = form.closest('.product-card');
  card.style.transition = 'all .35s ease';
  card.style.opacity    = '0';
  card.style.transform  = 'scale(.88)';
  setTimeout(() => form.submit(), 350);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   4. LIVE SEARCH INSIDE WISHLIST
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const searchInput = document.getElementById('wishlistSearch');
const clearBtn    = document.getElementById('clearSearch');
const noResults   = document.getElementById('noResults');

function filterCards(q) {
  const cards   = document.querySelectorAll('.product-card');
  let visible   = 0;
  const qLower  = q.toLowerCase().trim();
  cards.forEach(card => {
    const match = !qLower || (card.dataset.name || '').includes(qLower);
    card.style.display = match ? '' : 'none';
    if (match) visible++;
  });
  if (noResults) noResults.style.display = (visible === 0 && qLower) ? 'block' : 'none';
  if (clearBtn)  clearBtn.style.display  = qLower ? 'block' : 'none';
}

if (searchInput) {
  searchInput.addEventListener('input', function() { filterCards(this.value); });
}
if (clearBtn) {
  clearBtn.addEventListener('click', function() {
    searchInput.value = '';
    filterCards('');
    searchInput.focus();
  });
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   5. TOAST
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function showToast(msg) {
  const t = document.getElementById('toast');
  document.getElementById('toastText').textContent = msg;
  t.classList.add('show');
  clearTimeout(t._t);
  t._t = setTimeout(() => t.classList.remove('show'), 3200);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   6. TABS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', function() {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    this.classList.add('active');
  });
});

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   7. GRID / LIST VIEW TOGGLE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const grid = document.getElementById('wishlistGrid');
document.getElementById('viewGrid')?.addEventListener('click', function() {
  if (!grid) return;
  grid.style.gridTemplateColumns = 'repeat(auto-fill, minmax(240px, 1fr))';
  document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
  this.classList.add('active');
});
document.getElementById('viewList')?.addEventListener('click', function() {
  if (!grid) return;
  grid.style.gridTemplateColumns = '1fr';
  document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
  this.classList.add('active');
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>